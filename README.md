# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack
Для сборки используется Webpack.

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```
или

```
yarn
yarn start
```

## Сборка

```
npm run build
```
или

```
yarn build
```
## Архитектура

Приложение организовано в соответствии с паттерном MVP, где данные, представление и презентер взаимодействуют между собой через событийно-ориентированный подход.

- Слой модели занимается работой с данными - их получением, обработкой и изменением.

- Слой представления отвечает за отображение данных и работу с интерфейсом приложения.

- Презентер (реализован в файле index.ts) соединяет модель и представление, обеспечивая эффективное взаимодействие между ними.

Основное взаимодействие в приложении начинается с index.ts, который выполняет поиск шаблонов разметки, создает экземпляры классов для работы с бэкендом и EventEmitter. EventEmitter реализует паттерн "наблюдатель", позволяя компонентам подписываться на события и реагировать на них.

Далее приложение, используя цепочку событий, обрабатывает действия пользователя на странице через EventEmitter, обеспечивая взаимодействие с различными компонентами интерфейса приложения - формами, модальными окнами, корзиной.

В случае успешного сценария использования, информация о карточках в корзине, контактных данных пользователя, платежной информации и общей стоимости заказа отправляется на сервер с помощью POST-запроса, обрабатываемого экземпляром класса IproductsAPI.

Это позволяет эффективно управлять состоянием приложения, обеспечивать плавное взаимодействие пользователя с интерфейсом и передавать необходимую информацию между компонентами приложения.

## Ключевые интерфейсы

обзор ключевых интерфейсов  из файла index.ts в папке types:

1. IProduct: Интерфейс представляет товар, включая его идентификатор, описание, изображение, название, категорию и цену.
2. ISuccess: Описывает успешное модальное окно покупки, содержащее общую стоимость покупки.
3. IModalData: Определяет данные, необходимые для отображения в модальном окне, включая HTML-элемент контента.
4. IFormState: Описывает состояние формы, включая информацию о её валидности и список ошибок валидации.
5. IContactForm: Интерфейс для формы с контактными данными пользователя, такими как почта и телефон.
6. IOrderFormData: Интерфейс для формы с данными о заказе, такими как тип платежа и адрес доставки.
7. IOrder: Представляет интерфейс для оформленного заказа, включая контактные данные, информацию о заказе, список купленных товаров и общую стоимость.
8. IOrderSuccess: Описывает успешно оформленный заказ, включая его идентификатор и общую стоимость.
9. IBasketView: Интерфейс для отображения корзины с товарами и их общей стоимостью.
10. IAppState: Представляет глобальное состояние приложения, включая информацию о товарах, корзине, превью товара и оформленных заказах.
11. ICardActions: Описывает события, связанные с карточками товаров, такие как клик.
12. ICard: Интерфейс для отображения карточки товара, включая название, описание, изображение, категорию, цену и индекс для отображения в корзине.
13. IPageState: Описывает отображение главной страницы приложения, включая счётчик товаров в корзине, список доступных товаров и состояние блокировки прокрутки.
14. IProductsAPI: Интерфейс для взаимодействия с бэкендом, определяет методы для получения списка товаров, одного товара по его идентификатору и оформления заказа.


## Слой Model представлен классами 

1. Класс Model<T>: Этот класс определяет интерфейс модели данных с помощью обобщений (дженериков). Он принимает данные определенного типа (частично заполненные) и события, реализующие интерфейс IEvents, в конструкторе. Класс служит базовым уровнем для работы с данными и используется в основе класса AppState для управления глобальным состоянием приложения.
    
2. Класс AppState: Этот класс, наследуя класс Model с передачей интерфейса IAppState, управляет глобальными состояниями приложения, такими как каталог товаров, список заказов, товары в корзине, отображение превью товаров и т.д. В его конструкторе инициализируются начальные значения массивов заказов и товаров в корзине. Класс предоставляет методы для установки списка товаров каталога, списка заказов, товаров в корзине, а также для установки превью товара и валидации полей формы заказа. Кроме того, класс предоставляет методы для установки значений полей заказа и контактной информации, а также для получения списка товаров для заказа.

## Слой View представлен классами

1. Абстрактный класс Component<T>: Этот класс определяет интерфейс взаимодействия с определенным типом данных, который передается в виде обобщения (дженерика). Конструктор класса принимает контейнер в виде HTML-элемента. Класс представляет собой низкоуровневую обертку для работы с HTML-элементами и предоставляет следующие операции:
- toggleElementClass: Позволяет переключать класс на указанном элементе. Принимает элемент, название класса и флаг, указывающий на добавление или удаление класса.
- setText: Устанавливает текстовое содержимое на указанном элементе.
- setDisabled: Делает элемент доступным или недоступным для взаимодействия.
- hideElement: Скрывает указанный элемент.
- showElement: Показывает указанный элемент.
- setImage: Устанавливает изображение на указанном элементе, принимает ссылку на изображение и опциональное описание.
- render: Отрисовывает элемент с возможностью установки опциональных данных. Возвращает созданный HTML-элемент.
Этот класс служит основой для создания компонентов пользовательского интерфейса и предоставляет удобные методы для взаимодействия с HTML-элементами.

2. Класс Basket: Этот класс наследует класс Component с передачей интерфейса IBasketView.
- Конструктор класса принимает HTML-элемент контейнер и события типа EventEmitter.
Методы и свойства класса позволяют выполнять основные операции с корзиной заказов:
- items: устанавливает список товаров в корзине.
- setText: отображает итоговую сумму товаров в синапсах.
- total: устанавливает и получает итоговую цену всех товаров.
- button: возвращает разметку кнопки для последующей блокировки/разблокировки.

3. Класс Form: Этот класс наследует класс Component с передачей интерфейса IFormState.
- Конструктор класса принимает HTML-элемент контейнер и события типа EventEmitter.
Методы и свойства класса позволяют выполнять основные операции с формами:
- onInputChange: оповещает приложение об изменении данных в полях ввода формы.
- valid: устанавливает валидность формы, активируя кнопку формы.
- errors: отображает ошибки на форме при вводе значений в поля формы.
- render: переопределяет метод render родительского класса Component и рендерит форму в соответствии с текущим состоянием.

4. Класс Modal: Этот класс наследует класс Component с передачей интерфейса IModalData.
- Конструктор модального окна ищет элементы модального окна (закрытие, контент, сабмит) и устанавливает слушателя на кнопку закрытия.
- Метод modalContent позволяет отображать в модальном окне желаемый контент, что позволяет создать один экземпляр модального окна и постоянно менять в нем контент.
- Методы open и close позволяют скрывать и показывать модальное окно через передачу сообщений с помощью EventEmitter.
- Метод renderModal переопределяет метод render родительского класса Component и рендерит модальное окно с соответствующим контентом.

5. Класс Success: Этот класс наследует класс Component с передачей интерфейса ISuccess.
- Конструктор класса принимает HTML-элемент контейнер и события типа EventEmitter.
- Метод total устанавливает итоговую цену оплаченного заказа.
- Метод setText форматирует итоговое сообщение об успешно оплаченном заказе для отображения в соответствующем элементе интерфейса.

6. Класс Contacts: Этот класс наследует класс Form с передачей интерфейса IContactFormData.
Конструктор класса принимает HTML-элемент контейнер и события типа EventEmitter.
- Методы phone и email являются сеттерами, которые позволяют устанавливать значения телефона и почты пользователя.

7. Класс Order: Этот класс наследует класс Form с передачей интерфейса IOrderForm.
- Конструктор класса принимает HTML-элемент контейнер и события типа EventEmitter.
- Метод address является сеттером, который устанавливает адрес доставки.
- Геттер payment возвращает вид платежа. Фактический вид платежа устанавливается в конструкторе в зависимости от выбранного таба.

8. Класс Page: Этот класс наследует класс Component с передачей интерфейса IPageState.
- Конструктор класса принимает HTML-элемент контейнер и события типа EventEmitter.
- Методы counter, gallery и locked являются сеттерами, которые устанавливают счетчик корзины, список доступных к покупке товаров и блокировку/разблокировку прокрутки страницы соответственно.

9. Класс Card: Этот класс наследует класс Component с передачей интерфейса ICard.
- Конструктор класса производит поиск элементов через утилиту ensureElement, поэтому в конструктор помимо контейнера передается и blockName для поиска элементов именованных по БЭМ.
- Группа сеттеров category, price, title, buttonText, image и description устанавливают соответствующие атрибуты карточки, значения которых приходят с сервера.
- Геттеры buttonText и button возвращают текст на кнопке и сам элемент кнопки соответственно.
- Метод setIndexElement используется для установки номера позиции карточки в корзине товаров.

10. Класс CatalogItem наследуется от класса Card и отвечает за отображение карточки на различных модальных окнах в приложении, таких как начальный экран, превью и корзина. Его основная функциональность заключается в методе render(), который переопределяет метод render() родительского класса. В конструкторе класса принимается HTML-элемент контейнер, события типа EventEmitter и опциональный набор действий с карточкой типа ICardActions. Метод render() рендерит карточку с соответствующим набором атрибутов по шаблону.


## Слой Presenter представлен классами 
1. Класс EventEmitter реализует интерфейс IEvents и обеспечивает работу с событиями в приложении. В конструкторе инициализируется коллекция событий в виде Map, где ключом является имя события, а значением - множество подписчиков.
- Метод on() позволяет подписаться на определенное событие, принимая имя события и коллбэк-функцию, которая будет вызвана при его возникновении.
- Метод off() позволяет отписаться от определенного события, принимая имя события и коллбэк-функцию подписчика.
- Метод emit() используется для генерации события с опциональными данными определенного типа. Он принимает имя события и данные, которые будут переданы в коллбэк-функцию подписчиков данного события.
- Методы onAll() и offAll() позволяют подписаться и отписаться от всех событий приложения. Метод onAll() принимает коллбэк-функцию, которая будет вызвана при возникновении любого события.
- Метод trigger() генерирует указанное событие с определенными аргументами, что позволяет использовать его в качестве обработчика событий в других классах.

2. В файле index.ts в папке src находится точка сборки приложения, где происходит подключение всех модулей, поиск шаблонов разметки, создание экземпляров классов моделей и представлений, а также осуществляется запрос к бэкенду для получения данных и реализация логики событий через EventEmitter.

## Связь с сервером 
обеспечивается классом IproductsAPI, который наследует функциональность класса Api и реализует интерфейс IProductsAPI для получения и отправки данных о товарах. В конструкторе этого класса задается ссылка на CDN (Content Delivery Network) для получения контента сайта, базовая ссылка для взаимодействия с REST API, а также опциональные параметры для установки в заголовке запроса.
Этот класс предоставляет следующие методы:
- getItem(id: string): Получение информации о товаре по его идентификатору. Возвращает данные о товаре в соответствии с интерфейсом IProduct.
- getItemList(): Получение списка всех товаров. Возвращает массив товаров, каждый из которых соответствует интерфейсу IProduct.
- orderItems(order: IOrder): Оформление заказа с передачей данных о заказе в соответствии с интерфейсом IOrder. Возвращает ответ сервера, соответствующий интерфейсу IOrderSuccess.




